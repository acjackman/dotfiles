# -*- mode: zsh -*- vim: ft=zsh

# _jgw_absolutize_path - Convert relative display path back to absolute path
#
# Usage: _jgw_absolutize_path <display_path> <main_repo_root>
# Returns: absolute path

local display_path="$1"
local main_repo_root="$2"

# Already absolute
if [[ "$display_path" == /* ]]; then
    echo "$display_path"
    return 0
fi

# Path starts with ~/, expand it
if [[ "$display_path" == ~/* ]]; then
    echo "${display_path/#\~/$HOME}"
    return 0
fi

# Relative path (including .. paths), resolve it from main repo root
local abs_path="${main_repo_root}/${display_path}"
# Normalize the path (resolve .. and .)
if command -v grealpath >/dev/null 2>&1; then
    abs_path=$(grealpath "$abs_path" 2>/dev/null) || abs_path="${main_repo_root}/${display_path}"
elif command -v realpath >/dev/null 2>&1; then
    abs_path=$(realpath "$abs_path" 2>/dev/null) || abs_path="${main_repo_root}/${display_path}"
fi

echo "$abs_path"
