{{ if eq .chezmoi.os "darwin" -}}{{- $computerName := output "scutil" "--get" "ComputerName" | trim -}}
#!/bin/bash

# Install for {{ $computerName }}

function show-header() {
  command -v gum &>/dev/null
  if [ $? -eq 0 ]; then
    gum style --border=double --align=left --padding "0 2" --width=75 $@
  else
    echo $@
  fi
}

# Define array of Brewfiles to install based on computer name
brewfiles=(
{{- range (glob (printf "%s/.config/homebrew/Brewfile-*" .chezmoi.homeDir)) }}
"{{ . }}" # Checksum {{ include . | sha256sum }}
{{- end }}
)

# Loop through and install each Brewfile
for filename in "${brewfiles[@]}"; do
  # Skip .lock files
  if [[ "$filename" == *.lock.json ]]; then
    continue
  fi

  # Convert filename to display name (remove "Brewfile-" prefix and capitalize)
  display_name="Homebrew ${filename#Brewfile-}"

  show-header "$display_name"
  brew bundle --file="$filename"
done

{{ end -}}
